# Wave Visualizer（波形ビジュアライザー）

## 🎯 プロジェクトの目的

このアプリケーションは、**録音した音声を FFT（高速フーリエ変換）で周波数成分に分解し、位相情報も含めて元の音声を再現する**音響実験システムです。

Sample Page:
https://masnak.github.io/waveVisualizer/

## 🌟 最新の主要機能

### 🎤 音声録音・再生

- **3 秒間の高品質録音**（44.1kHz サンプリング）
- **リアルタイム波形表示**（緑色オシロスコープ）
- **録音音声の再生機能**
- **ステータスメッセージ表示**（リアルタイムフィードバック）

### 📊 リアルタイム可視化

- **時間軸波形表示**（1200×200 ピクセル）
- **周波数スペクトラム表示**（リアルタイム FFT、8192 サンプル）
- **周波数グリッド**（500Hz 間隔、ラベル付き）

### 🔬 **位相情報保持 FFT 解析** ⭐**NEW**

- **超高精度 FFT 解析**（**8192 サンプル**、ハミング窓適用）
- **位相情報完全保持**（振幅 + 位相角 + 複素成分）
- **周波数分解能**: 約 5.4Hz
- **上位 100 成分の抽出・表示**（位相角付き）

## 🚀 使用方法

### 基本的な実験手順

1. **初期化**

   ```
   「Initialize」ボタンをクリック
   → マイクアクセス許可
   → リアルタイム可視化開始
   ```

2. **音声録音**

   ```
   「Record」ボタンをクリック
   → 3秒間録音（口笛や「あー」などの持続音を推奨します）
   → 自動停止
   ```

3. **元音声確認**

   ```
   「Playback」ボタンをクリック
   → 録音した音声を再生
   ```

4. **位相情報付き FFT 解析** ⭐**NEW**

   ```
   「Analyse」ボタンをクリック
   → 位相情報保持で周波数成分に分解
   → 振幅・位相・相対音量付きリスト表示
   ```

5. **高品質音声再現実験** ⭐**NEW**

   **方法 1: 全成分合成**

   ```
   ✅「全てを選択」→ 🔊「合成再生」
   → 全周波数成分で位相制御合成
   ```

   **方法 2: 段階的実験**

   ```
   ★1（最大成分）をチェック → 基本周波数を確認
   ★2〜★5を追加 → 音の質感変化を体験
   🔊「合成再生」→ 位相制御で高品質合成
   ⚖️「原音との比較」→ 元音と聞き比べ
   ```

6. **実験終了**
   ```
   ❌「全てを解除」で全選択解除＋音停止
   または「Stop Sine Waves」で全正弦波停止
   ```

### 🎛️ **UI 機能**

| ボタン              | 機能                             |
| ------------------- | -------------------------------- |
| ✅ **全てを選択**   | 解析された全周波数成分を一括選択 |
| ❌ **全てを解除**   | 全選択解除＋再生中サイン波停止   |
| 🔊 **合成再生**     | 位相制御による高品質音声合成     |
| ⚖️ **原音との比較** | 元録音と合成音の聞き比べ         |

### 📈 結果の読み方

| 表示項目           | 説明                                     |
| ------------------ | ---------------------------------------- |
| ★1〜★10            | 重要度の高い周波数成分（太字・緑色表示） |
| 周波数             | Hz 単位（5.4Hz 精度）                    |
| 音量               | 最大成分に対する相対比率（0.000〜1.000） |
| **位相** ⭐**NEW** | **位相角（度）**                         |
| パーセント表示     | 相対音量の百分率（0%〜100%）             |

## 💡 実験のコツ

### 推奨する録音音声

- **口笛**：明確な基本周波数＋倍音（最適）
- **母音（あ・え・い・お・う）**：位相効果が顕著
- **楽器音**：ピアノ、フルート等の単音
- **避けるべき音**：ノイズ、複雑な音楽、会話

### 効果的な実験方法

1. **位相の重要性確認**：合成音と原音の品質差を体験
2. **段階的追加**：★1 から順番に追加して音質変化を観察
3. **全成分合成**：「全てを選択」→「合成再生」で最高品質
4. **比較実験**：「原音との比較」で再現精度を確認

## 🛠 技術仕様

### システム要件

- **ブラウザ**：Chrome 66+, Firefox 60+, Safari 11.1+
- **マイク**：任意の音声入力デバイス
- **インターネット**：不要（ローカル実行可能）

### 音声処理仕様 ⭐**UPDATED**

```
サンプリング周波数: 44.1kHz
録音時間: 3秒間
FFTサイズ: 8192サンプル（従来の4倍）
窓関数: ハミング窓
周波数分解能: 5.4Hz（44.1kHz時）
位相精度: ±0.1度
表示成分数: 最大100成分
合成方式: 位相制御AudioBuffer事前生成
```

### ファイル構成

```
waveVisualizer/
├── index.html              # メインUI（ボタン・キャンバス）
├── main.js                 # 音声録音・再生・初期化
├── waveVisualizer.js       # リアルタイム波形表示
├── spectrumVisualizer.js   # リアルタイムスペクトラム表示
├── sinewaveAnalyser.js     # 位相情報保持FFT・音声合成
├── README.md               # このファイル
└── claude.md               # 詳細技術ドキュメント
```

## 🖥 ローカル実行方法

### Python 使用（推奨）

```bash
# プロジェクトディレクトリに移動
cd waveVisualizer

# ローカルサーバー起動
python3 -m http.server 8000

# ブラウザでアクセス
open http://localhost:8000
```

### Node.js 使用

```bash
npx http-server -p 8000
```

## 🔧 トラブルシューティング

### マイクアクセスが許可されない

- **HTTPS または localhost**でアクセス
- ブラウザのマイク許可設定を確認
- プライベートモードを無効化

### 音が聞こえない

- システム音量を確認
- ブラウザの音声出力設定を確認
- 「Initialize」を再実行

### 解析結果が 0 件

- 録音時に実際に音を出す
- マイクの音量レベルを確認
- 静かな環境で録音

### 合成音が元音と違う ⭐**NEW**

- **位相情報が重要**：従来の振幅のみでは限界
- **「合成再生」を使用**：個別サイン波より高品質
- **全成分選択推奨**：部分選択では音質低下

## 📄 ライセンス

MIT License - 教育・研究目的での自由利用を許可
