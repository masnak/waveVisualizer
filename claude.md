# Wave Visualizer（波形ビジュアライザー）

リアルタイム音声可視化と正弦波解析のための JavaScript ベース Web アプリケーション。

## プロジェクト構成

```
/
├── index.html              # メインHTMLページ、UIコントロールとcanvas要素
├── main.js                 # メインアプリケーションロジックと音声処理
├── waveVisualizer.js       # 波形表示用WaveVisualizerクラス
├── spectrumVisualizer.js   # 周波数スペクトラム表示用SpectrumVisualizerクラス
└── sinewaveAnalyser.js     # 正弦波解析と再生機能
```

## ブラウザ画面のボタンと機能

### メインコントロールボタン

| ボタン名            | 初期状態       | 機能説明             | 実行される処理                                                                                                                                    |
| ------------------- | -------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Initialize**      | 有効           | 音声システムの初期化 | ・Audio Context の作成<br>・マイクへのアクセス許可<br>・リアルタイム波形・スペクトラム表示開始<br>・初期化後はボタン無効化                        |
| **Record**          | 有効（赤太字） | 3 秒間音声録音       | ・録音開始と同時に「Now Recording...」表示<br>・3 秒後自動停止<br>・完了後、Playback と Analyse ボタン有効化                                      |
| **Playback**        | 無効           | 録音音声の再生       | ・録音した音声データの再生<br>・再生中は可視化も同期表示<br>・再生終了後、可視化をマイク入力に戻す                                                |
| **Analyse**         | 無効           | FFT 解析の実行       | ・録音データの周波数解析（FFT サイズ：2048）<br>・振幅上位 100 成分の表示<br>・正弦波リスト表示<br>・解析後はボタン無効化、Stop Sine Waves 有効化 |
| **Stop Sine Waves** | 無効           | 全正弦波停止         | ・再生中のすべての正弦波を一括停止<br>・すべてのチェックボックスを未選択に変更                                                                    |

### 動的生成される周波数成分チェックボックス

**表示条件**: Analyse ボタン実行後

**機能**:

- 各周波数成分に対応する個別チェックボックス
- チェック時：その周波数の正弦波を生成・再生
- チェック解除時：対応する正弦波の再生停止
- 表示形式：「Frequency: XXX.XX Hz, Amplitude: XXX.XXXXX」

## 主要機能

- **リアルタイム音声録音**: マイクから 3 秒間の音声キャプチャ
- **波形可視化**: 緑色のオシロスコープスタイルによるリアルタイム波形表示
- **スペクトラム解析**: 周波数グリッドとラベル付きの周波数スペクトラム可視化
- **音声再生**: 録音音声の再生と視覚フィードバック
- **正弦波解析**: FFT ベースの解析による卓越周波数の特定
- **インタラクティブ正弦波生成**: 解析結果から個別正弦波の生成・再生

## コアコンポーネント

### Audio Context 設定

- Web Audio API 使用、44.1kHz サンプルレート
- マイク入力用 MediaStreamSource を作成
- リアルタイム音声解析用 AnalyserNode を実装

### 可視化クラス

- **WaveVisualizer**: 時間領域波形表示（1200x200 canvas）
- **SpectrumVisualizer**: 周波数領域スペクトラム表示（グリッドオーバーレイ付き）

### 解析機能

- FFT サイズ：2048 サンプル
- 上位 100 周波数成分を表示
- デシベル単位での振幅測定
- 正弦波再生用インタラクティブチェックボックス

## 使用ワークフロー

1. **「Initialize」**をクリックして音声コンテキストとマイクアクセスを設定
2. **「Record」**をクリックして 3 秒間の音声をキャプチャ
3. **「Playback」**で録音音声を再生
4. **「Analyse」**で FFT 解析を実行し、周波数成分を表示
5. 周波数の横のチェックボックスを選択して対応する正弦波を生成
6. **「Stop Sine Waves」**ですべての生成音を停止

## 依存関係

- Web Audio API（ブラウザ内蔵サポート）
- マイクアクセス用 MediaDevices API
- 可視化用 Canvas 2D API
- 外部 JavaScript ライブラリ不要

## 技術仕様

- Audio Context の初期化にはユーザージェスチャ（クリックイベント）が必要
- リアルタイム可視化は requestAnimationFrame を使用してスムーズ更新
- FFT 解析は振幅を dB スケールに変換して表示
- 正弦波生成は OscillatorNode と GainNode を音量制御に使用
